# azure-pipelines.yml
# Pipeline for Breast Cancer Prediction ML script

trigger:
- main  # Run automatically on push to main branch

pool:
  vmImage: 'ubuntu-latest'

variables:
  PYTHON_VERSION: '3.10'
  WORKSPACE: '$(Build.SourcesDirectory)'
  OUTPUT_DIR: '$(WORKSPACE)/outputs'

steps:

# 1️⃣ Use the specified Python version
- task: UsePythonVersion@0
  inputs:
    versionSpec: '$(PYTHON_VERSION)'
    addToPath: true
  displayName: 'Use Python $(PYTHON_VERSION)'

# 2️⃣ Install Python dependencies
- script: |
    python -m pip install --upgrade pip
    pip install --prefer-binary -r requirements.txt
  workingDirectory: $(WORKSPACE)
  displayName: 'Install Python dependencies'

# 3️⃣ Create output directories
- script: |
    mkdir -p $(OUTPUT_DIR)/Patient_Predictions
    mkdir -p $(OUTPUT_DIR)/Plots
  displayName: 'Create output directories'

# 4️⃣ Run the ML script
- script: |
    python src/SOK_XGBoost_Gradnt_Boost_Breast_Cancer.py \
      --output-csv $(OUTPUT_DIR)/Patient_Predictions \
      --output-plots $(OUTPUT_DIR)/Plots
  workingDirectory: $(WORKSPACE)
  displayName: 'Run Breast Cancer Prediction Script'

# 5️⃣ Publish CSV predictions
- task: PublishPipelineArtifact@1
  inputs:
    targetPath: '$(OUTPUT_DIR)/Patient_Predictions'
    artifact: 'Patient_Predictions'
    publishLocation: 'pipeline'
  displayName: 'Publish Patient Predictions'

# 6️⃣ Publish plots
- task: PublishPipelineArtifact@1
  inputs:
    targetPath: '$(OUTPUT_DIR)/Plots'
    artifact: 'Plots'
    publishLocation: 'pipeline'
  displayName: 'Publish Plots'
